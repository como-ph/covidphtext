library(httr)
set_config(config(ssl_verifypeer = 0L))

## Test get_iatf_links #########################################################
base <- "http://www.doh.gov.ph/COVID-19/IATF-Resolutions/"

x <- get_iatf_links(base = base)

test_that("x is a tibble", {
  expect_is(x, "tbl")
})

test_that("x has 7 columns", {
  expect_equal(ncol(x), 7)
})

test_that("id is numeric", {
  expect_is(x$id, "numeric")
})

test_that("date is a date", {
  expect_is(x$date, "Date")
})

test_that("source is iatf", {
  expect_true(all(x$source == "IATF"))
})

test_that("url is a url", {
  expect_true(all(stringr::str_detect(x$url, "http")))
})


## Test get_iatf_pdf ###########################################################

links <- iatfLinksGazette

x <- get_iatf_pdfs(links = links, id = 10)

test_that("path is character", {
  expect_is(x, "character")
})

test_that("name of filename vector is correct", {
  expect_true(names(x) == "iatfResolution10")
})

test_that("error message shows", {
  expect_error(get_iatf_pdfs(links = links, id = "1"))
})

## Test get_iatf_gazette #######################################################
base <- "https://www.officialgazette.gov.ph/section/laws/other-issuances"
agency <- "inter-agency-task-force-for-the-management-of-emerging-infectious-diseases-resolutions/"
pages <- list_iatf_pages(base = paste(base, agency, sep = "/"), pages = 1)
iatfPages <- get_iatf_pages(pages = pages)
x <- get_iatf_gazette(iatfPages)

test_that("x is a tibble", {
  expect_is(x, "tbl")
})

test_that("x has 7 columns", {
  expect_equal(ncol(x), 7)
})

test_that("id is numeric", {
  expect_is(x$id, "numeric")
})

test_that("date is a date", {
  expect_is(x$date, "Date")
})

test_that("source is iatf", {
  expect_true(all(x$source == "IATF"))
})

test_that("url is a url", {
  expect_true(all(stringr::str_detect(x$url, "http")))
})
